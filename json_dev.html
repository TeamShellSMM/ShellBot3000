<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>#TeamShell</title>
</head>
<body>
<h1>ShellBot API tester</h1>
<div class="container">

<div class="row">
<code id="loginOut"></code>
<form id="postsJson" method="post">
  <h3>Authentication Info (To be stored in localStorage)</h3>
  <label>discord_id<input id="discord_id" name="discord_id" class="form-control"/></label>
  <label>bearer token<input id="bearer_token" name="bearer_token" class="form-control"/></label>
  <h3>Get Authenticated JSON (Check console for result)</h3> 
  <input class="form-control btn btn-primary" type="submit" name="action" value="Get Authenticated JSON"/>
</form>
</div>


<div class="row">
<h3>Clear Checker</h3>
<code id="clearOut"></code>
<form id="clear" method="post">
  <label>Code <input class="form-control" type="text" name="code"/></label>
  <label>Completed<input type="text" class="form-control" name="completed" value="1"/></label>
  <label>Difficulty vote<input type="text" class="form-control" name="difficulty"/></label>
  <label>Liked<input type="text" class="form-control" name="like" value="1"/></label>
  <input class="form-control btn btn-primary" type="submit" name="action" value="Clear"/>
</form>
</div>



<div class="row">
<h3>Approval</h3>
<code id="approvalOut"></code>
<form id="approve" method="post">
  <label>Code <input class="form-control" type="text" name="code"/></label>
  <label>Type<input class="form-control" type="text" name="type" placeholder="accept/reject" /></label>
  <label>Completed<input type="text" class="form-control" name="completed" value="1"/></label>
  <label>Comment<textarea class="form-control" name="comment"></textarea></label>
  <label>Difficulty vote<input type="text" class="form-control" name="difficulty"/></label>
  <label>Liked<input type="text" class="form-control" name="like" value="1"/></label>
  <input class="form-control btn btn-primary" type="submit" name="action" value="Clear"/>
</form>
</div>

</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
<script>
$("#otp").val(location.search.substring(7))
var discord_id=null;
var token=null;
var lastUpdated=null;

$.ajax({
    url : "./json/login",
    type: "post",
    data : {
      otp:location.search.substring(7)
    }
  }).done(function(response){ //
    console.log(response)
    if(response.status=="logged_in"){
      discord_id=response.discord_id;
      token=response.token
      $("#discord_id").val(discord_id)
      $("#bearer_token").val(token)
      $("#loginOut").html(JSON.stringify(response))
    } else {
      $("#loginOut").html(JSON.stringify(response))
    }
    
  });

$("#postsJson").submit(function(event){
  event.preventDefault(); //prevent default action 
  
  $.ajax({
    url : "./json",
    type: "post",
    data : {
      discord_id:discord_id,
      token:token,
      lastLoaded:lastUpdated
    }
  }).done(function(response){ //
    console.log(response)
  });
})

$("#clear").submit(function(event){
  event.preventDefault(); //prevent default action 


  var form_data = $(this).serialize(); //Encode form elements for submission
  
  $.ajax({
    url : './clear',
    type: "post",
    data : form_data+"&token="+token
  }).done(function(response){ //
    console.log(response)
    $("#clearOut").html(JSON.stringify(response))
  });
})

$("#approve").submit(function(event){
  event.preventDefault(); //prevent default action 

  var form_data = $(this).serialize(); //Encode form elements for submission
  $.ajax({
    url : './approve',
    type: "post",
    data : form_data+"&token="+token
  }).done(function(response){ //
    console.log(response)
    $("#approveOut").html(JSON.stringify(response))
  });
})

</script>
<style>
h3 {margin-top:2em;}
</style>
</body>
</html>