<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>#TeamShell</title>
</head>
<body>
<h1>ShellBot API tester</h1>
<div class="container">

<label> Team <input id="urlSlugInput" class="form-control" type="text" value="teamshell"/></label>

<div class="row">
<div class="col-sm-12">
<code id="loginOut"></code>
<form id="postsJson" method="post">
  <input type="hidden" name="url_slug" value="teamshell"/>
  <h3>Authentication Info (To be stored in localStorage)</h3>
  <label>discord_id<input id="discord_id" name="discord_id" class="form-control"/></label>
  <label>bearer token<input id="bearer_token" name="bearer_token" class="form-control"/></label>
  <h3>Get Authenticated JSON (Check console for result)</h3> 
  <input class="form-control btn btn-primary" type="submit" name="action" value="Get Authenticated JSON"/>
</form>
</div>
</div>


<div class="row">
<div class="col-sm-12">
<h3>Clear Checker</h3>
<code id="clearOut"></code>
<form id="clear" method="post">
  <input type="hidden" name="url_slug" value="teamshell"/>
  <label>Code <input class="form-control" type="text" name="code"/></label>
  <label>Completed<input type="text" class="form-control" name="completed" value='1'/></label>
  <label>Difficulty vote<input type="text" class="form-control" name="difficulty"/></label>
  <label>Liked<input type="text" class="form-control" name="like" value='1'/></label>
  <input class="form-control btn btn-primary" type="submit" name="action" value="Clear"/>
</form>
</div>
</div>


<div class="row">
<div class="col-sm-12">
<h3>Random</h3>
<code id="randomOut"></code>
<form class="form" id="random" method="post">
  <input type="hidden" name="url_slug" value="teamshell"/>
  <label>Min Difficulty<input class="form-control" type="text" name="minDifficulty"/></label>
  <label>Max Difficulty<input class="form-control" type="text" name="maxDifficulty"/></label>
  <input class="form-control btn btn-primary" type="submit" name="action" value="Random"/>
</form>
</div>
</div>

<div class="row">
<div class="col-sm-12">
<h3>Approval</h3>
<code id="approvalOut"></code>
<form id="approve" method="post">
  <input type="hidden" name="url_slug" value="teamshell"/>
  <label>Code <input class="form-control" type="text" name="code"/></label>
  <label>Type<input class="form-control" type="text" name="type" placeholder="accept/reject" /></label>
  <label>Completed<input type="text" class="form-control" name="completed" value='1'/></label>
  <label>Comment<textarea class="form-control" name="comment"></textarea></label>
  <label>Difficulty vote<input type="text" class="form-control" name="difficulty"/></label>
  <label>Liked<input type="text" class="form-control" name="like" value='1'/></label>
  <input class="form-control btn btn-primary" type="submit" name="action" value="Approve"/>
</form>
</div>
</div>


</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
<link href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/4.3.1/css/bootstrap.min.css" rel="stylesheet">
<script>
$("#otp").val(location.search.substring(7))
var discord_id=null;
var token=null;
var lastUpdated=null;

$("input[name=url_slug").val($("#urlSlugInput").val())

$("#urlSlugInput").change(function(){
  $("input[name=url_slug").val($("#urlSlugInput").val())
})

$.ajax({
    url : "./json/login",
    type: "post",
    data : {
      otp:location.search.substring(7),
      url_slug:$("#urlSlugInput").val(),
    }
  }).done(function(response){ //
    console.log(response)
    if(response.status=="logged_in"){
      discord_id=response.discord_id;
      token=response.token
      $("#discord_id").val(discord_id)
      $("#bearer_token").val(token)
      $("#loginOut").html(JSON.stringify(response))
    } else {
      $("#loginOut").html(JSON.stringify(response))
    }
    
  });

$("#postsJson").submit(function(event){
  event.preventDefault(); //prevent default action 
  
  $.ajax({
    url : "./json",
    type: "post",
    data : {
      token:token,
      url_slug:$("#urlSlugInput").val()
    }
  }).done(function(response){ //
    console.log(response)
  });
})

$("#clear").submit(function(event){
  event.preventDefault(); //prevent default action 


  var form_data = $(this).serialize(); //Encode form elements for submission
  
  $.ajax({
    url : './clear',
    type: "post",
    data : form_data+"&token="+token
  }).done(function(response){ //
    console.log(response)
    $("#clearOut").html(JSON.stringify(response))
  });
})

$("#random").submit(function(event){
  event.preventDefault(); //prevent default action 
  var form_data = $(this).serialize(); //Encode form elements for submission
  $.ajax({
    url : './random',
    type: "post",
    data : form_data+"&token="+token
  }).done(function(response){ //
    console.log(response)
    $("#randomOut").html(JSON.stringify(response))
  });
})

$("#approve").submit(function(event){
  event.preventDefault(); //prevent default action 

  var form_data = $(this).serialize(); //Encode form elements for submission
  $.ajax({
    url : './approve',
    type: "post",
    data : form_data+"&token="+token
  }).done(function(response){ //
    console.log(response)
    $("#approveOut").html(JSON.stringify(response))
  });
})

</script>
<style>
h3 {margin-top:2em;}
</style>
</body>
</html>